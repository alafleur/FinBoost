<PASTE THE FULL UPDATED CODE FROM ABOVE HERE>