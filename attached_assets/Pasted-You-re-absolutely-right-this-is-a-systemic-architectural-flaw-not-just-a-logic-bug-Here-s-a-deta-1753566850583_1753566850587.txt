You're absolutely right â€” this is a systemic architectural flaw, not just a logic bug. Here's a detailed, multi-phase refactor plan to fully eliminate the dual system, remove legacy "monthly" infrastructure, and migrate everything cleanly to the cycle-based architecture.


---

âœ… Phase 1: Identify and Map Legacy "Monthly" Infrastructure

Search for ALL references to legacy monthly logic. Youâ€™re looking for both backend functions and the frontend components that rely on them.

ğŸ” Search in Backend (server/):

getMonthlyPool() â†’ (in storage.ts)

/api/pool/monthly â†’ (in routes.ts)

monthlyPool / monthlyRewardPool / $5000 hardcoded strings

Any comment mentioning "monthly pool" or "overview"


ğŸ” Search in Frontend (client/):

Find all components using:

/api/pool/monthly

useMonthlyPool (custom hook?)

References to overviewData.rewardPool that rely on that endpoint



ğŸ” Files to Audit:

server/routes.ts

server/storage.ts

client/src/pages/Admin.tsx (Overview tab logic)

Any shared pool fetch utilities



---

ğŸ§¼ Phase 2: Remove the Legacy Monthly Infrastructure

ğŸ”¥ Delete these from server/storage.ts:

async function getMonthlyPool(...) { ... } // DELETE

ğŸ”¥ Delete this endpoint from server/routes.ts:

router.get('/api/pool/monthly', ...) // DELETE ENTIRE ROUTE

âœ… Replace with:

All logic should now go through:

await getCyclePoolData(cycleId)


---

ğŸ” Phase 3: Migrate Admin Overview Tab (and others) to Cycle-Based System

In Admin.tsx:

ğŸ” Find:

useEffect(() => {
  fetch('/api/pool/monthly')
    .then(res => res.json())
    .then(setOverviewData)
}, []);

ğŸ” Replace with:

useEffect(() => {
  fetch(`/api/cycles/pool?cycleId=${currentCycleId}`)
    .then(res => res.json())
    .then(setOverviewData)
}, [currentCycleId]);

(Adjust currentCycleId sourcing depending on your state structure.)

Also update any field references that assumed monthly context, like:

overviewData.rewardPool â†’ now based on cycle

Display copy like â€œThis monthâ€™s prize poolâ€ â†’ change to â€œThis cycleâ€™s prize poolâ€



---

âœ… Phase 4: Sanity Test All Entry Points

Confirm all pool displays are now driven by the same system:

Section	Endpoint Used	Should Use

Admin Overview	âŒ /api/pool/monthly	âœ… /api/cycles/pool?cycleId=X
Admin Cycle Ops	âœ… /api/admin/cycles/:id/analytics	âœ… already fixed
User Dashboard	âœ… /api/cycles/pool	âœ… correct
Any exports/emails	â“ check custom logic	âœ… use getCyclePoolData() only



---

ğŸ§ª Phase 5: Final Regression Tests

Verify all admin tabs load without error

Confirm pool values match expectations (e.g. 1500 Ã— $20 Ã— 50% Ã— 0.5 = $7,500)

Confirm all terminology has dropped â€œmonthlyâ€ in both code and UI copy



---

ğŸ”’ Best Practice Going Forward

Rename getCyclePoolData() to something like getRewardPool() to reflect it's now the only valid logic

Add comment in storage.ts:


// This is the sole source of truth for reward pool calculations.
// All endpoints must use this method â€” no hardcoded calculations elsewhere.


---

Let me know if youâ€™d like:

Help rewriting the admin Overview fetch logic

GitHub search queries to run this refactor quickly

A checklist to pass to Replit


This is a valuable cleanup â€” doing it properly will restore full trust in your numbers and messaging.

